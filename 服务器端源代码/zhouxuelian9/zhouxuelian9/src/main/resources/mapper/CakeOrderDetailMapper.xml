<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.smxy.zhouxuelian9.mapper.CakeOrderDetailMapper">
    <!-- 插入订单详情 -->
    <insert id="insert" parameterType="cn.smxy.zhouxuelian9.entity.CakeOrderDetail">
        INSERT INTO cakeorderdetail (cakeorderId, cakeId, num, subtotal, remark)
        VALUES (#{cakeorderId}, #{cakeId}, #{num}, #{subtotal}, #{remark})
    </insert>

    <!-- 查询所有订单详情 -->
    <select id="selectAllOrderDetails" resultType="cn.smxy.zhouxuelian9.entity.CakeOrderDetail">
        SELECT * FROM cakeorderdetail
    </select>

    <!-- 根据订单ID查询订单详情 -->
    <select id="selectByOrderId" parameterType="String" resultType="cn.smxy.zhouxuelian9.entity.CakeOrderDetail">
        SELECT * FROM cakeorderdetail WHERE cakeorderId = #{cakeorderId}
    </select>

    <!-- 更新订单详情 -->
    <update id="updateOrderDetail" parameterType="cn.smxy.zhouxuelian9.entity.CakeOrderDetail">
        UPDATE cakeorderdetail
        SET cakeId = #{cakeId},
            num = #{num},
            subtotal = #{subtotal},
            remark = #{remark}
        WHERE cakedetailId = #{cakedetailId}
    </update>

    <!-- 删除订单详情 -->
    <delete id="deleteOrderDetail" parameterType="int">
        DELETE FROM cakeorderdetail WHERE cakedetailId = #{detailId}
    </delete>

    <!-- 关联查询订单详情和蛋糕信息 -->
    <select id="getOrderDetailById" resultMap="OrderDetailResultMap">
        SELECT od.*, c.cakeName, c.price, c.cakePicture
        FROM cakeorderdetail od
                 JOIN cake c ON od.cakeId = c.cakeId
        WHERE od.cakeorderId = #{cakeorderId}
    </select>

    <resultMap id="OrderDetailResultMap" type="cn.smxy.zhouxuelian9.entity.CakeOrderDetail">
        <id property="cakedetailId" column="cakedetailId"/>
        <result property="cakeorderId" column="cakeorderId"/>
        <result property="cakeId" column="cakeId"/>
        <result property="num" column="num"/>
        <result property="subtotal" column="subtotal"/>
        <result property="remark" column="remark"/>

        <!-- 关联 Cake 对象 -->
        <association property="cake" javaType="cn.smxy.zhouxuelian9.entity.Cake">
            <id property="cakeId" column="cakeId"/>
            <result property="cakeName" column="cakeName"/>
            <result property="price" column="price"/>
            <result property="cakePicture" column="cakePicture"/>
        </association>
    </resultMap>
</mapper>